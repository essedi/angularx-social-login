{"version":3,"file":"facebook-login-provider.js","sourceRoot":"","sources":["../../../lib/src/providers/facebook-login-provider.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseLoginProvider } from '../entities/base-login-provider';\nimport { SocialUser } from '../entities/user';\nimport { LoginOpt } from '../auth.service';\n\ndeclare let FB: any;\n\nexport class FacebookLoginProvider extends BaseLoginProvider {\n\n  public static readonly PROVIDER_ID = 'FACEBOOK';\n\n  constructor(\n    private clientId: string,\n    private opt: LoginOpt = { scope: 'email,public_profile' },\n    private locale: string = 'en_US',\n    private fields: string = 'name,email,picture,first_name,last_name',\n    private version: string = 'v2.9'\n  ) { super(); }\n\n  initialize(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.loadScript(FacebookLoginProvider.PROVIDER_ID,\n        `//connect.facebook.net/${this.locale}/sdk.js`,\n        () => {\n          FB.init({\n            appId: this.clientId,\n            autoLogAppEvents: true,\n            cookie: true,\n            xfbml: true,\n            version: this.version\n          });\n          // FB.AppEvents.logPageView(); #FIX for #18\n\n          this._readyState.next(true);\n          resolve();\n        });\n    });\n  }\n\n  getLoginStatus(): Promise<SocialUser> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        FB.getLoginStatus((response: any) => {\n          if (response.status === 'connected') {\n            let authResponse = response.authResponse;\n            FB.api(`/me?fields=${this.fields}`, (fbUser: any) => {\n              let user: SocialUser = new SocialUser();\n\n              user.id = fbUser.id;\n              user.name = fbUser.name;\n              user.email = fbUser.email;\n              user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n              user.firstName = fbUser.first_name;\n              user.lastName = fbUser.last_name;\n              user.authToken = authResponse.accessToken;\n\n              user.facebook = fbUser;\n\n              resolve(user);\n            });\n          }\n        });\n      });\n    });\n  }\n\n  signIn(opt?: LoginOpt): Promise<SocialUser> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        FB.login((response: any) => {\n          if (response.authResponse) {\n            let authResponse = response.authResponse;\n            FB.api(`/me?fields=${this.fields}`, (fbUser: any) => {\n              let user: SocialUser = new SocialUser();\n\n              user.id = fbUser.id;\n              user.name = fbUser.name;\n              user.email = fbUser.email;\n              user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n              user.firstName = fbUser.first_name;\n              user.lastName = fbUser.last_name;\n              user.authToken = authResponse.accessToken;\n\n              user.facebook = fbUser;\n\n              resolve(user);\n            });\n          } else {\n            reject('User cancelled login or did not fully authorize.');\n           }\n        }, this.opt);\n      });\n    });\n  }\n\n  signOut(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        FB.logout((response: any) => {\n          resolve();\n        });\n      });\n    });\n  }\n\n}\n"]}