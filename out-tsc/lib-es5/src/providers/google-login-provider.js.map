{"version":3,"file":"google-login-provider.js","sourceRoot":"","sources":["../../../lib/src/providers/google-login-provider.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseLoginProvider } from '../entities/base-login-provider';\nimport { SocialUser } from '../entities/user';\nimport { LoginOpt } from '../auth.service';\n\ndeclare let gapi: any;\n\nexport class GoogleLoginProvider extends BaseLoginProvider {\n\n  public static readonly PROVIDER_ID: string = 'GOOGLE';\n\n  protected auth2: any;\n\n  constructor(private clientId: string, private opt: LoginOpt = {scope: 'email'}) { super(); }\n\n  initialize(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.loadScript(GoogleLoginProvider.PROVIDER_ID,\n        '//apis.google.com/js/platform.js',\n        () => {\n          gapi.load('auth2', () => {\n            this.auth2 = gapi.auth2.init({\n              ...this.opt,\n              client_id: this.clientId\n            });\n\n            this.auth2.then(() => {\n              this._readyState.next(true);\n              resolve();\n            }).catch((err: any) => {\n              reject(err);\n            });\n          });\n        });\n    });\n  }\n\n  getLoginStatus(): Promise<SocialUser> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        if (this.auth2.isSignedIn.get()) {\n          let user: SocialUser = new SocialUser();\n          let profile = this.auth2.currentUser.get().getBasicProfile();\n          let token = this.auth2.currentUser.get().getAuthResponse(true).access_token;\n          let backendToken = this.auth2.currentUser.get().getAuthResponse(true).id_token;\n\n          user.id = profile.getId();\n          user.name = profile.getName();\n          user.email = profile.getEmail();\n          user.photoUrl = profile.getImageUrl();\n          user.firstName = profile.getGivenName();\n          user.lastName = profile.getFamilyName();\n          user.authToken = token;\n          user.idToken = backendToken;\n          resolve(user);\n        }\n      });\n    });\n  }\n\n  signIn(opt?: LoginOpt): Promise<SocialUser> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        let promise = this.auth2.grantOfflineAccess(opt);\n        \n        promise.then(() => {\n            \n          let user: SocialUser = new SocialUser();\n          let profile = this.auth2.currentUser.get().getBasicProfile();\n          let token = this.auth2.currentUser.get().getAuthResponse(true).access_token;\n          let backendToken = this.auth2.currentUser.get().getAuthResponse(true).id_token;\n          user.id = profile.getId();\n          user.name = profile.getName();\n          user.email = profile.getEmail();\n          user.photoUrl = profile.getImageUrl();\n          user.firstName = profile.getGivenName();\n          user.lastName = profile.getFamilyName();\n          user.authToken = token;\n          user.idToken = backendToken;\n          resolve(user);\n        }, (closed: any) => {\n            reject('User cancelled login or did not fully authorize.');\n        }).catch((err: any) => {\n          reject(err);\n        });\n      });\n    });\n  }\n\n  signOut(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        this.auth2.signOut().then((err: any) => {\n          if (err) {\n            reject(err);\n          } else {\n            resolve();\n          }\n        }).catch((err: any) => {\n          reject(err);\n        });\n      });\n    });\n  }\n\n  revokeAuth(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        this.auth2.disconnect().then((err: any) => {\n          if (err) {\n            reject(err);\n          } else {\n            resolve();\n          }\n        }).catch((err: any) => {\n          reject(err);\n        });\n      });\n    });\n  }\n\n}\n"]}