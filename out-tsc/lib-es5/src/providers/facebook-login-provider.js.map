{"version":3,"file":"facebook-login-provider.js","sourceRoot":"","sources":["../../../lib/src/providers/facebook-login-provider.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,OAAO,EAAE,iBAAiB,EAAE,MAAM,iCAAiC,CAAC;AACpE,OAAO,EAAE,UAAU,EAAE,MAAM,kBAAkB,CAAC;;IAKH,yCAAiB;IAI1D,+BACU,UACA,KACA,QACA,QACA;sCAHkB,KAAK,EAAE,sBAAsB;;;;QAFzD,YAMI,iBAAO,SAAG;QALJ,cAAQ,GAAR,QAAQ;QACR,SAAG,GAAH,GAAG;QACH,YAAM,GAAN,MAAM;QACN,YAAM,GAAN,MAAM;QACN,aAAO,GAAP,OAAO;;KACH;;;;IAEd,0CAAU;;;IAAV;QAAA,iBAkBC;QAjBC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,KAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,WAAW,EAC/C,4BAA0B,KAAI,CAAC,MAAM,YAAS,EAC9C;gBACE,EAAE,CAAC,IAAI,CAAC;oBACN,KAAK,EAAE,KAAI,CAAC,QAAQ;oBACpB,gBAAgB,EAAE,IAAI;oBACtB,MAAM,EAAE,IAAI;oBACZ,KAAK,EAAE,IAAI;oBACX,OAAO,EAAE,KAAI,CAAC,OAAO;iBACtB,CAAC,CAAC;;gBAGH,AAFA,2CAA2C;gBAE3C,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC5B,OAAO,EAAE,CAAC;aACX,CAAC,CAAC;SACN,CAAC,CAAC;KACJ;;;;IAED,8CAAc;;;IAAd;QAAA,iBAyBC;QAxBC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,KAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAClB,EAAE,CAAC,cAAc,CAAC,UAAC,QAAa;oBAC9B,EAAE,CAAC,CAAC,QAAQ,CAAC,MAAM,KAAK,WAAW,CAAC,CAAC,CAAC;wBACpC,qBAAI,cAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;wBACzC,EAAE,CAAC,GAAG,CAAC,gBAAc,KAAI,CAAC,MAAQ,EAAE,UAAC,MAAW;4BAC9C,qBAAI,IAAI,GAAe,IAAI,UAAU,EAAE,CAAC;4BAExC,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,CAAC;4BACpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;4BACxB,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;4BAC1B,IAAI,CAAC,QAAQ,GAAG,6BAA6B,GAAG,MAAM,CAAC,EAAE,GAAG,sBAAsB,CAAC;4BACnF,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC;4BACnC,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC;4BACjC,IAAI,CAAC,SAAS,GAAG,cAAY,CAAC,WAAW,CAAC;4BAE1C,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;4BAEvB,OAAO,CAAC,IAAI,CAAC,CAAC;yBACf,CAAC,CAAC;qBACJ;iBACF,CAAC,CAAC;aACJ,CAAC,CAAC;SACJ,CAAC,CAAC;KACJ;;;;;IAED,sCAAM;;;;IAAN,UAAO,GAAc;QAArB,iBA2BC;QA1BC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,KAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAClB,EAAE,CAAC,KAAK,CAAC,UAAC,QAAa;oBACrB,EAAE,CAAC,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC;wBAC1B,qBAAI,cAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;wBACzC,EAAE,CAAC,GAAG,CAAC,gBAAc,KAAI,CAAC,MAAQ,EAAE,UAAC,MAAW;4BAC9C,qBAAI,IAAI,GAAe,IAAI,UAAU,EAAE,CAAC;4BAExC,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,CAAC;4BACpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;4BACxB,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;4BAC1B,IAAI,CAAC,QAAQ,GAAG,6BAA6B,GAAG,MAAM,CAAC,EAAE,GAAG,sBAAsB,CAAC;4BACnF,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC;4BACnC,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC;4BACjC,IAAI,CAAC,SAAS,GAAG,cAAY,CAAC,WAAW,CAAC;4BAE1C,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;4BAEvB,OAAO,CAAC,IAAI,CAAC,CAAC;yBACf,CAAC,CAAC;qBACJ;oBAAC,IAAI,CAAC,CAAC;wBACN,MAAM,CAAC,kDAAkD,CAAC,CAAC;qBAC3D;iBACH,EAAE,KAAI,CAAC,GAAG,CAAC,CAAC;aACd,CAAC,CAAC;SACJ,CAAC,CAAC;KACJ;;;;IAED,uCAAO;;;IAAP;QAAA,iBAQC;QAPC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,KAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAClB,EAAE,CAAC,MAAM,CAAC,UAAC,QAAa;oBACtB,OAAO,EAAE,CAAC;iBACX,CAAC,CAAC;aACJ,CAAC,CAAC;SACJ,CAAC,CAAC;KACJ;wCA9FoC,UAAU;gCARjD;EAM2C,iBAAiB;SAA/C,qBAAqB","sourcesContent":["import { BaseLoginProvider } from '../entities/base-login-provider';\nimport { SocialUser } from '../entities/user';\nimport { LoginOpt } from '../auth.service';\n\ndeclare let FB: any;\n\nexport class FacebookLoginProvider extends BaseLoginProvider {\n\n  public static readonly PROVIDER_ID = 'FACEBOOK';\n\n  constructor(\n    private clientId: string,\n    private opt: LoginOpt = { scope: 'email,public_profile' },\n    private locale: string = 'en_US',\n    private fields: string = 'name,email,picture,first_name,last_name',\n    private version: string = 'v2.9'\n  ) { super(); }\n\n  initialize(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.loadScript(FacebookLoginProvider.PROVIDER_ID,\n        `//connect.facebook.net/${this.locale}/sdk.js`,\n        () => {\n          FB.init({\n            appId: this.clientId,\n            autoLogAppEvents: true,\n            cookie: true,\n            xfbml: true,\n            version: this.version\n          });\n          // FB.AppEvents.logPageView(); #FIX for #18\n\n          this._readyState.next(true);\n          resolve();\n        });\n    });\n  }\n\n  getLoginStatus(): Promise<SocialUser> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        FB.getLoginStatus((response: any) => {\n          if (response.status === 'connected') {\n            let authResponse = response.authResponse;\n            FB.api(`/me?fields=${this.fields}`, (fbUser: any) => {\n              let user: SocialUser = new SocialUser();\n\n              user.id = fbUser.id;\n              user.name = fbUser.name;\n              user.email = fbUser.email;\n              user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n              user.firstName = fbUser.first_name;\n              user.lastName = fbUser.last_name;\n              user.authToken = authResponse.accessToken;\n\n              user.facebook = fbUser;\n\n              resolve(user);\n            });\n          }\n        });\n      });\n    });\n  }\n\n  signIn(opt?: LoginOpt): Promise<SocialUser> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        FB.login((response: any) => {\n          if (response.authResponse) {\n            let authResponse = response.authResponse;\n            FB.api(`/me?fields=${this.fields}`, (fbUser: any) => {\n              let user: SocialUser = new SocialUser();\n\n              user.id = fbUser.id;\n              user.name = fbUser.name;\n              user.email = fbUser.email;\n              user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n              user.firstName = fbUser.first_name;\n              user.lastName = fbUser.last_name;\n              user.authToken = authResponse.accessToken;\n\n              user.facebook = fbUser;\n\n              resolve(user);\n            });\n          } else {\n            reject('User cancelled login or did not fully authorize.');\n           }\n        }, this.opt);\n      });\n    });\n  }\n\n  signOut(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.onReady().then(() => {\n        FB.logout((response: any) => {\n          resolve();\n        });\n      });\n    });\n  }\n\n}\n"]}